From e32c1f3b0464ddbf584eaf6a296365bf1e015dd9 Mon Sep 17 00:00:00 2001
From: Tiago Vignatti <tiago.vignatti@intel.com>
Date: Mon, 6 May 2013 18:15:08 -0300
Subject: [PATCH 2/6] views: Implement Ozone root window for desktop aura

Signed-off-by: Tiago Vignatti <tiago.vignatti@intel.com>
---
 ui/base/ozone/surface_factory_ozone.cc             |    7 ++++++
 ui/base/ozone/surface_factory_ozone.h              |   16 ++++++++++++++
 ui/views/views.gyp                                 |    1 +
 .../desktop_aura/desktop_root_window_host_ozone.cc |   23 ++++++++++++++++++++
 4 files changed, 47 insertions(+)
 create mode 100644 ui/views/widget/desktop_aura/desktop_root_window_host_ozone.cc

diff --git a/ui/base/ozone/surface_factory_ozone.cc b/ui/base/ozone/surface_factory_ozone.cc
index 7d8d64b..f8d3cb5 100644
--- a/ui/base/ozone/surface_factory_ozone.cc
+++ b/ui/base/ozone/surface_factory_ozone.cc
@@ -61,6 +61,13 @@ gfx::Screen* SurfaceFactoryOzone::CreateDesktopScreen() {
   return NULL;
 }
 
+views::DesktopRootWindowHost* SurfaceFactoryOzone::CreateDesktopRootWindowHost(
+    views::internal::NativeWidgetDelegate* native_widget_delegate,
+    views::DesktopNativeWidgetAura* desktop_native_widget_aura,
+    const gfx::Rect& bounds) {
+  return NULL;
+}
+
 // static
 SurfaceFactoryOzone* SurfaceFactoryOzone::CreateTestHelper() {
   return new SurfaceFactoryOzoneStub;
diff --git a/ui/base/ozone/surface_factory_ozone.h b/ui/base/ozone/surface_factory_ozone.h
index 5df6bd9..6c903fb 100644
--- a/ui/base/ozone/surface_factory_ozone.h
+++ b/ui/base/ozone/surface_factory_ozone.h
@@ -14,6 +14,15 @@ class Screen;
 class VSyncProvider;
 } //  namespace gfx
 
+namespace views {
+class DesktopNativeWidgetAura;
+class DesktopRootWindowHost;
+
+namespace internal {
+class NativeWidgetDelegate;
+} // namespace internal
+} // namespace views
+
 namespace ui {
 
 class UI_EXPORT SurfaceFactoryOzone {
@@ -35,6 +44,13 @@ class UI_EXPORT SurfaceFactoryOzone {
   // This method implements gfx::Screen, particularly useful in Desktop Aura.
   virtual gfx::Screen* CreateDesktopScreen();
 
+  // TODO(rjkroege): decide how to separate screen/display stuff from SFOz
+  // TODO(vignatti): description
+  virtual views::DesktopRootWindowHost* CreateDesktopRootWindowHost(
+      views::internal::NativeWidgetDelegate* native_widget_delegate,
+      views::DesktopNativeWidgetAura* desktop_native_widget_aura,
+      const gfx::Rect& bounds);
+
   // TODO(rjkroege): Add a status code if necessary.
   // Configures the display hardware. Must be called from within the GPU
   // process before the sandbox has been activated.
diff --git a/ui/views/views.gyp b/ui/views/views.gyp
index 979b788..ccf95db 100644
--- a/ui/views/views.gyp
+++ b/ui/views/views.gyp
@@ -371,6 +371,7 @@
         'widget/desktop_aura/desktop_native_widget_aura.cc',
         'widget/desktop_aura/desktop_native_widget_aura.h',
         'widget/desktop_aura/desktop_root_window_host.h',
+        'widget/desktop_aura/desktop_root_window_host_ozone.cc',
         'widget/desktop_aura/desktop_root_window_host_win.cc',
         'widget/desktop_aura/desktop_root_window_host_win.h',
         'widget/desktop_aura/desktop_root_window_host_x11.cc',
diff --git a/ui/views/widget/desktop_aura/desktop_root_window_host_ozone.cc b/ui/views/widget/desktop_aura/desktop_root_window_host_ozone.cc
new file mode 100644
index 0000000..cbc20d4
--- /dev/null
+++ b/ui/views/widget/desktop_aura/desktop_root_window_host_ozone.cc
@@ -0,0 +1,23 @@
+// Copyright (c) 2013 The Chromium Authors. All rights reserved.
+// Use of this source code is governed by a BSD-style license that can be
+// found in the LICENSE file.
+
+#include "ui/aura/root_window_host.h"
+#include "ui/views/widget/desktop_aura/desktop_root_window_host.h"
+
+#include "ui/base/ozone/surface_factory_ozone.h"
+
+namespace views {
+
+DesktopRootWindowHost* DesktopRootWindowHost::Create(
+    internal::NativeWidgetDelegate* native_widget_delegate,
+    DesktopNativeWidgetAura* desktop_native_widget_aura,
+    const gfx::Rect& initial_bounds) {
+  ui::SurfaceFactoryOzone* factory = ui::SurfaceFactoryOzone::GetInstance();
+
+  return factory->CreateDesktopRootWindowHost(native_widget_delegate,
+                                              desktop_native_widget_aura,
+                                              initial_bounds);
+}
+
+}  // namespace views
-- 
1.7.9.5

