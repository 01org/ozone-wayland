From 7448d7ff64d57579faf8f06c7fb006884a5c826b Mon Sep 17 00:00:00 2001
From: Kondapally Kalyan <kalyan.kondapally@intel.com>
Date: Sun, 22 Sep 2013 01:14:28 +0300
Subject: [PATCH] Chromium-Add-gl-changes-for-Wayland.

This patch adds basic support needed in NativeViewGLSurfaceEGL to resize window.
Changes related to resizing needs more testing before trying to upstream the patch.
---
 ui/gl/gl_surface_egl.cc |   15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/ui/gl/gl_surface_egl.cc b/ui/gl/gl_surface_egl.cc
index d93a945..4d5576a 100644
--- a/ui/gl/gl_surface_egl.cc
+++ b/ui/gl/gl_surface_egl.cc
@@ -116,8 +116,7 @@ bool GLSurfaceEGL::InitializeOneOff() {
     LOG(ERROR) << "OZONE failed to initialize hardware";
     return false;
   }
-  g_native_display = reinterpret_cast<EGLNativeDisplayType>(
-      surface_factory->GetNativeDisplay());
+  g_native_display = surface_factory->GetNativeDisplay();
 #else
   g_native_display = EGL_DEFAULT_DISPLAY;
 #endif
@@ -141,7 +140,7 @@ bool GLSurfaceEGL::InitializeOneOff() {
     EGL_GREEN_SIZE, 8,
     EGL_RED_SIZE, 8,
     EGL_RENDERABLE_TYPE, EGL_OPENGL_ES2_BIT,
-    EGL_SURFACE_TYPE, EGL_WINDOW_BIT | EGL_PBUFFER_BIT,
+    EGL_SURFACE_TYPE, EGL_WINDOW_BIT,
     EGL_NONE
   };
 
@@ -393,6 +392,7 @@ bool NativeViewGLSurfaceEGL::Resize(const gfx::Size& size) {
   GLContext* current_context = GLContext::GetCurrent();
   bool was_current =
       current_context && current_context->IsCurrent(this);
+
   if (was_current) {
     scoped_make_current.reset(
         new ui::ScopedMakeCurrent(current_context, this));
@@ -401,6 +401,15 @@ bool NativeViewGLSurfaceEGL::Resize(const gfx::Size& size) {
 
   Destroy();
 
+#if defined(USE_OZONE)
+  gfx::SurfaceFactoryOzone* surface_factory =
+    gfx::SurfaceFactoryOzone::GetInstance();
+
+  surface_factory->AttemptToResizeAcceleratedWidget(window_,
+                                                    gfx::Rect(0, 0, size.width(),
+                                                              size.height()));
+#endif
+
   if (!Initialize()) {
     LOG(ERROR) << "Failed to resize window.";
     return false;
-- 
1.7.9.5

