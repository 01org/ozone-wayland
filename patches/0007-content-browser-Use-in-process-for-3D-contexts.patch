From 74748756c3ca60fb4a9af8ca8d1edc78d1c49c29 Mon Sep 17 00:00:00 2001
From: Tiago Vignatti <tiago.vignatti@intel.com>
Date: Fri, 12 Jul 2013 19:13:33 -0300
Subject: [PATCH 7/9] content/browser: Use in-process for 3D contexts

This has to be properly implemented later to use command buffer (GPU process).

Signed-off-by: Tiago Vignatti <tiago.vignatti@intel.com>
---
 .../renderer_host/image_transport_factory.cc       |    5 +++++
 1 file changed, 5 insertions(+)

diff --git a/content/browser/renderer_host/image_transport_factory.cc b/content/browser/renderer_host/image_transport_factory.cc
index bb126e5..d298f26 100644
--- a/content/browser/renderer_host/image_transport_factory.cc
+++ b/content/browser/renderer_host/image_transport_factory.cc
@@ -1007,12 +1007,17 @@ void ImageTransportFactory::Initialize() {
   if (command_line->HasSwitch(switches::kTestCompositor)) {
     ui::SetupTestCompositor();
   }
+#if defined(USE_OZONE)
+    // XXX: hack for in-process only 3D contexts
+    g_factory = new NoTransportFactory(NULL);
+#else
   if (ui::IsTestCompositorEnabled()) {
     g_factory = new NoTransportFactory(new ui::TestContextFactory);
   } else {
     g_factory = new GpuProcessTransportFactory;
   }
   ui::ContextFactory::SetInstance(g_factory->AsContextFactory());
+#endif
 }
 
 // static
-- 
1.7.9.5

